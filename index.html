<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
</script>

<script>
const url = 'pdf/mon-document.pdf'; // pdf dans le dossier pdf/
const flipbook = $("#flipbook");

let zoomScale = 1;

pdfjsLib.getDocument(url).promise.then(pdf => {
    let loadedPages = 0;
    let totalPages = pdf.numPages;

    for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        pdf.getPage(pageNum).then(page => {
            const viewport = page.getViewport({ scale: 1.5 });
            const canvas = document.createElement("canvas");
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            const ctx = canvas.getContext("2d");

            page.render({ canvasContext: ctx, viewport: viewport }).promise.then(() => {
                const div = $('<div class="page"></div>').append(canvas);
                flipbook.append(div);

                loadedPages++;

                // Quand toutes les pages sont chargées
                if (loadedPages === totalPages) {
                    // Initialiser Turn.js après que toutes les pages soient dans le DOM
                    flipbook.turn({
                        width: 800,   // largeur fixe pour que ça fonctionne
                        height: 600,  // hauteur fixe
                        autoCenter: true
                    });

                    // Zoom tactile
                    const hammertime = new Hammer(flipbook[0]);
                    hammertime.get("pinch").set({ enable: true });
                    hammertime.on("pinch", ev => {
                        zoomScale = Math.min(Math.max(zoomScale * ev.scale, 0.5), 3);
                        applyZoom();
                    });

                    flipbook.on("wheel", function(e){
                        e.preventDefault();
                        zoomScale += e.originalEvent.deltaY < 0 ? 0.1 : -0.1;
                        zoomScale = Math.min(Math.max(zoomScale, 0.5), 3);
                        applyZoom();
                    });

                    // Boutons
                    $("#prevBtn").click(()=> flipbook.turn("previous"));
                    $("#nextBtn").click(()=> flipbook.turn("next"));
                }
            });
        });
    }
});

function applyZoom(){
    flipbook.css("transform", `scale(${zoomScale})`);
    flipbook.css("transform-origin", "center center");
}
</script>
