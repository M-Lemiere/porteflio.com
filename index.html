<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Flipbook PDF A3 Vertical Responsive</title>
<style>
body { font-family: Arial; text-align: center; margin: 20px; }
.container { width: 95%; max-width: 900px; margin: auto; }
#flipbook { margin: auto; }
#flipbook .page { background: white; width: 100%; height: 100%; cursor: pointer; }
</style>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Turn.js local -->
<script src="js/turn.min.js"></script>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
</script>

<!-- Hammer.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
</head>
<body>

<h1>Flipbook PDF A3 Vertical Responsive</h1>

<div class="container">
    <div id="flipbook"></div>
</div>

<script>
const url = 'pdf/mon-document.pdf';
const flipbook = $("#flipbook");
let zoomScale = 1;

function initFlipbook(width, height) {
    flipbook.turn({
        width: width,
        height: height,
        autoCenter: true
    });
}

function applyZoom() {
    flipbook.css("transform", `scale(${zoomScale})`);
    flipbook.css("transform-origin", "center center");
}

// Charger le PDF
pdfjsLib.getDocument(url).promise.then(pdf => {
    let loadedPages = 0;
    const totalPages = pdf.numPages;

    for (let i = 1; i <= totalPages; i++) {
        pdf.getPage(i).then(page => {
            const viewport = page.getViewport({ scale: 2.0 }); // meilleur détail pour A3
            const canvas = document.createElement("canvas");
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            const ctx = canvas.getContext("2d");

            page.render({ canvasContext: ctx, viewport: viewport }).promise.then(() => {
                const div = $('<div class="page"></div>').append(canvas);
                flipbook.append(div);
                loadedPages++;

                if (loadedPages === totalPages) {
                    // Calcul responsive basé sur PDF
                    const maxWidth = $('.container').width();
                    const maxHeight = $(window).height() * 0.8; // 80% hauteur écran
                    const scale = Math.min(maxWidth / viewport.width, maxHeight / viewport.height);

                    initFlipbook(viewport.width * scale, viewport.height * scale);

                    // Redimensionnement responsive
                    $(window).resize(() => {
                        const newScale = Math.min($('.container').width() / viewport.width,
                                                  $(window).height() * 0.8 / viewport.height);
                        flipbook.turn("size", viewport.width * newScale, viewport.height * newScale);
                    });

                    // Zoom tactile
                    const hammertime = new Hammer(flipbook[0]);
                    hammertime.get("pinch").set({ enable: true });
                    hammertime.on("pinch", ev => {
                        zoomScale = Math.min(Math.max(zoomScale * ev.scale, 0.5), 3);
                        applyZoom();
                    });

                    // Zoom molette
                    flipbook.on("wheel", e => {
                        e.preventDefault();
                        zoomScale += e.originalEvent.deltaY < 0 ? 0.1 : -0.1;
                        zoomScale = Math.min(Math.max(zoomScale, 0.5), 3);
                        applyZoom();
                    });

                    // Flip en cliquant sur la page
                    flipbook.on("click", function(e){
                        const offset = $(this).offset();
                        const clickX = e.pageX - offset.left;
                        const halfWidth = $(this).width() / 2;
                        if(clickX < halfWidth){
                            flipbook.turn("previous");
                        } else {
                            flipbook.turn("next");
                        }
                    });
                }
            });
        });
    }
});
</script>

</body>
</html>
